
<% include ../include/header.ejs %>
<!-- Site wrapper -->
<div class="wrapper">

  <% include ../include/menu.ejs %>



  <!-- =============================================== -->

   <% include ../include/left_sidebar.ejs %>


  <!-- =============================================== -->

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper order-details-page">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Order Details
        <small></small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Order Details</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">

    <!--
      <div class="callout callout-info">
       
        

      </div>

      -->


      <!-- Default box -->
      <div class="box">
        <div class="box-header with-border">
          <h3 class="box-title"></h3>
        
          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
              <i class="fa fa-minus"></i></button>
            <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove">
              <i class="fa fa-times"></i></button>
          </div>
        </div>
        <div class="box-body">
      

           <section class="content">
            <div class="row">
              <div class="col-xs-12">
                
                <!-- /.box -->

                <div class="box">
                  <!--
                  <div class="box-header">
                    <h3 class="box-title"></h3>
                  </div>
                -->
                  <!-- /.box-header -->
                  <div class="box-body">
                    <table id="example1" class="table table-bordered table-striped">
                      <thead>
                      <tr style="background-color:#3c8dbc;">
                        <th>Sr.No.</th>
                        <th>Name</th>
                        <th>Order Date</th>
                        <th>Delivery Date</th>
                        <th>Phone Number</th>
                        <th>Address</th>
                        <th>Order Amount</th>
                        <th>Executive</th>
                        <th>Status<th>
                      
                      </tr>
                      </thead>
                      <tbody>

                     
                      
                       <% for(var i=0; i < orders.length; i++) { %>



                        <tr>
                          <td><%= i+1 %></td>
                          <td><%= orders[i].firstName %> <%= orders[i].lastName %></td>
                          <% if(orders[i].orderDate){%> <td><%= orders[i].orderDate %></td> <%}else{ %> <td align="center">-</td><%} %>

                          <% if(orders[i].deliveryDate){%> <td><%= orders[i].deliveryDate %></td> <%}else{ %> <td align="center">-</td><%} %>
                          <% if(orders[i].deliveryphoneNumber){%> <td><%= orders[i].deliveryphoneNumber %></td> <%}else{ %> <td align="center">-</td><%} %>

                          <% if(orders[i].deliveryAddress){%> <td><%= orders[i].deliveryAddress %></td> <%}else{ %> <td align="center">-</td><%} %>
                          <% if(orders[i].total){%> <td>₹<%= orders[i].total %></td> <%}else{ %> <td align="center">-</td><%} %>
                        
                          <% if(orders[i].deliveryExecutive){%>
                          <td><%=orders[i].deliveryExecutive%></td>
                          <%}else{ %>
                          <td><button type="button" name="accept" id="accept" class="btn btn-block btn-danger btn-sm" onclick="assignDeliverExecutive(<%= orders[i].orderId %>);">Assign</button></td>

                          <%}%>

                           <td>Pending</td>
                            <td><button type="button" class="btn btn-info btn-sm" onclick="getOrderDetails(<%= orders[i].orderId %>);" >Details</button></td>
                          

                          
                           
                        </tr>
                          
                        <% } %>
                       
                        
                      </tbody>
                     
                    </table>
                  </div>
                  <!-- /.box-body -->
                </div>
                <!-- /.box -->
              </div>
              <!-- /.col -->
            </div>
      <!-- /.row -->



          <!-- Modal -->
          <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">Order Details</h4>
                </div>
                <div class="modal-body">
                  <table id="example1" class="table table-bordered table-striped">
                      <thead>
                      <tr style="background-color:#00c0ef">
                        <th>Sr.No.</th>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Total</th>
                        
                      </tr>
                      </thead>
                      <tbody id="orderDetailsData">
                      </tbody>
                    </thead>
                  </table>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>

            </div>
          </div>


          <!-- Executive list Modal -->
          <div id="executiveModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

            <input type="hidden" name="assingOrderID" id="assingOrderID" value="">

              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">Order Details</h4>
                </div>
                <div class="modal-body">
                  <table id="example1" class="table table-bordered table-striped">
                      <thead>
                      <tr style="background-color:#00c0ef">
                        <th>Sr.No.</th>
                        <th>Picture</th>
                        <th>Name</th>
                        <th>EmailId</th>
                        <th>Phone No</th>
                        <th>#</th>
                        
                      </tr>
                      </thead>
                      <tbody id="executiveDetailsData">
                      </tbody>
                    </thead>
                  </table>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>

            </div>
          </div>



    </section>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
        </div>
        <!-- /.box-footer-->
      </div>
      <!-- /.box -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->



  <% include ../include/footer.ejs %>

  <script>

  function getOrderDetails(orderId){

  $.get('/orderDetails?orderId='+orderId,function(data){

  console.log(data);

  var dataAppend='';
  var sr=1;

  for(var i=0;i<data.length;i++){

    //var dataAppend .= '<tr><td>"'+data[i].itemId+'"</td><td>"'+data[i].quantity'"</td><tr>';

     dataAppend += "<tr><td>"+sr+"</td><td>"+data[i].itemName+"</td><td>"+data[i].quantity+"</td><td>₹"+data[i].price+"</td><td>₹"+data[i].total+"</td><tr>";

     sr++;
 }

  $("#orderDetailsData").html(dataAppend)

  $("#myModal").modal('show');


  })

    
  }




          
  function assignDeliverExecutive(orderId){

      $.get('/assignDeliverExecutives?orderId='+orderId,function(data){

    console.log(data);

        $("#assingOrderID").val(orderId);

    var dataAppend='';
    var sr=1;
    var executiveName='';

    for(var i=0;i<data.length;i++){

      var executiveName = data[i].firstName+' '+data[i].lastName;

      var profile = '<img src="user_images/'+data[i].profilePicture+'" width="30px" height="30px" alt="No image">';


       // var selectAt = '<input type="radio" name="gender" value="other" >';


       dataAppend += "<tr><td>"+sr+"</td><td>"+profile+"</td><td>"+executiveName+"</td><td>"+data[i].emailId+"</td><td>"+data[i].phoneNumber+"</td><td><input type='radio' name='gender' value='+data[i].id' onclick='assignOrder("+data[i].id+");'></td><tr>";

       sr++;
   }

    $("#executiveDetailsData").html(dataAppend)

    $("#executiveModal").modal('show');


    })




  }


  function assignOrder(executiveId){

  console.log(executiveId);

      var assingOrderID=$("#assingOrderID").val();
      swal({
            title: "Are you sure?",
            text: "Assign the order",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Yes",
            closeOnConfirm: true
          },
          function(){
            //swal("Deleted!", "Your imaginary file has been deleted.//", "success");


            $.get('/saveDeliverExecutives?executiveId='+executiveId+'&assingOrderID='+assingOrderID,function(data){

            $("#executiveModal").modal('hide');
            location.reload();



                
            });
          });                                         
  }
 
 

 
  </script>
